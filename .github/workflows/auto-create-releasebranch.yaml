name: Auto Release branch create

on:
  push:
    branches:
      - master

jobs:
  auto-branch-create:
    name: "Release branch create"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - id: unix-time
        name: Get Date
        run: |
          U_TIME=$(date +%s%3N)
          echo "::set-output name=u-time::$U_TIME"
      - name: check
        id: check
        uses: ./.github/actions/update-confirm
      - name: Get Release Target branch
        run: |
          COMMIT_COUNT=$(jq -r '.commits[].id' $GITHUB_EVENT_PATH | wc -l)
          git config --global user.email "iwasaki-so@dmm.com"
          git config --global user.name "MSA-SRE-BOT"
          echo "COMMIT_COUNT: ${COMMIT_COUNT}"
          git remote update
          git fetch --all
          git checkout -b "release/stg/${{steps.unix-time.outputs.u-time}}" origin/stg
          git branch
          git cherry-pick ${{steps.check.outputs.before-sha}}..${{steps.check.outputs.after-sha}}
          git push origin "release/stg/${{steps.unix-time.outputs.u-time}}"




